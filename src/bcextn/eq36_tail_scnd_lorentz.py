from .mpmath import mp,mpf

class TailIntegral:
    def __init__(self,theta_degree, x, a):
        sinth = mp.sin(mpf(theta_degree) * mp.pi/mpf(180) )
        v, e = _impl_taylor_tail_scnd_lorentz( sinth, x, a )
        norm = mpf(2) / mp.pi
        self.__val = norm * v
        self.__err = norm * e

    @property
    def a( self ):
        return mpf( self.__a )

    @property
    def value( self ):
        return mpf( self.__val )

    @property
    def relerror( self ):
        return mpf( self.__err / self.__val )

    @property
    def error( self ):
        return mpf( self.__err )

def _impl_taylor_tail_scnd_lorentz( sinth, x, a ):
    m = mpf
    sinth = m(sinth)
    a = m(a)
    b = m(1)/m(a)
    k = m(x)*b
    def s( power ):
        return sinth**m(power)
    c1 = m(1)
    c2 = m("-2/3")*k
    c3 = ( m("-1/3")+m("128/225")*(k**2) )+m("64/225")*(k**2)*s("5/2")
    c4 = ( m("4/5")*k+m("-256/567")*(k**3) )+m("-512/567")*(k**3)*s(3)
    c5 = ( m("1/5")+m("-128/105")*(k**2)+m("8192/25515")*(k**4) )+m("-64/105")*(k**2)*s("5/2")+m("53248/25515")*(k**4)*s("7/2")
    c6 = ( m("-6/7")*k+m("1024/729")*(k**3)+m("-8192/40095")*(k**5) )+m("2048/729")*(k**3)*s(3)+m("-176128/40095")*(k**5)*s(4)
    c7 = ( m("-1/7")+m("256/135")*(k**2)+m("-8192/6237")*(k**4)+m("1048576/8955765")*(k**6) )+m("128/135")*(k**2)*s("5/2")+m("-53248/6237")*(k**4)*s("7/2")+m("81526784/8955765")*(k**6)*s("9/2")
    c8 = ( m("8/9")*k+m("-2560/891")*(k**3)+m("16384/15795")*(k**5)+m("-1048576/17222625")*(k**7) )+m("-5120/891")*(k**3)*s(3)+m("352256/15795")*(k**5)*s(4)+m("-329252864/17222625")*(k**7)*s(5)
    c9 = ( m("1/9")+m("-256/99")*(k**2)+m("8192/2457")*(k**4)+m("-1048576/1476225")*(k**6)+m("33554432/1159427115")*(k**8) )+m("-128/99")*(k**2)*s("5/2")+m("4096/189")*(k**4)*s("7/2")+m("-81526784/1476225")*(k**6)*s("9/2")+m("47529852928/1159427115")*(k**8)*s("11/2")
    c10 = ( m("-10/11")*k+m("5120/1053")*(k**3)+m("-57344/18225")*(k**5)+m("8388608/19518975")*(k**7)+m("-67108864/5301123975")*(k**9) )+m("10240/1053")*(k**3)*s(3)+m("-1232896/18225")*(k**5)*s(4)+m("2634022912/19518975")*(k**7)*s(5)+m("-475566964736/5301123975")*(k**9)*s(6)
    c11 = ( m("-1/11")+m("128/39")*(k**2)+m("-8192/1215")*(k**4)+m("4194304/1673055")*(k**6)+m("-33554432/143981145")*(k**8)+m("4294967296/837856594575")*(k**10) )+m("64/39")*(k**2)*s("5/2")+m("-53248/1215")*(k**4)*s("7/2")+m("326107136/1673055")*(k**6)*s("9/2")+m("-47529852928/143981145")*(k**8)*s("11/2")+m("167418898939904/837856594575")*(k**10)*s("13/2")
    c12 = ( m("12/13")*k+m("-1792/243")*(k**3)+m("458752/61965")*(k**5)+m("-4194304/2423925")*(k**7)+m("134217728/1171827405")*(k**9)+m("-8589934592/4447085001975")*(k**11) )+m("-3584/243")*(k**3)*s(3)+m("9863168/61965")*(k**5)*s(4)+m("-1317011456/2423925")*(k**7)*s(5)+m("951133929472/1171827405")*(k**9)*s(6)+m("-2009069736951808/4447085001975")*(k**11)*s(7)
    c13 = ( m("1/13")+m("-896/225")*(k**2)+m("16384/1377")*(k**4)+m("-4194304/623295")*(k**6)+m("33554432/31827411")*(k**8)+m("-4294967296/83422950975")*(k**10)+m("274877906944/403966572384375")*(k**12) )+m("-448/225")*(k**2)*s("5/2")+m("106496/1377")*(k**4)*s("7/2")+m("-326107136/623295")*(k**6)*s("9/2")+m("47529852928/31827411")*(k**8)*s("11/2")+m("-167418898939904/83422950975")*(k**10)*s("13/2")+m("417888017114464256/403966572384375")*(k**12)*s("15/2")
    c14 = ( m("-14/15")*k+m("14336/1377")*(k**3)+m("-114688/7695")*(k**5)+m("8388608/1607445")*(k**7)+m("-738197504/1283430015")*(k**9)+m("34359738368/1611262681875")*(k**11)+m("-137438953472/610797457445175")*(k**13) )+m("28672/1377")*(k**3)*s(3)+m("-2465792/7695")*(k**5)*s(4)+m("2634022912/1607445")*(k**7)*s(5)+m("-5231236612096/1283430015")*(k**9)*s(6)+m("8036278947807232/1611262681875")*(k**11)*s(7)+m("-1462608884534345728/610797457445175")*(k**13)*s(8)
    c15 = ( m("-1/15")+m("3584/765")*(k**2)+m("-16384/855")*(k**4)+m("2097152/137781")*(k**6)+m("-33554432/9506889")*(k**8)+m("8589934592/30225706875")*(k**10)+m("-274877906944/33560299859625")*(k**12)+m("35184372088832/501871910867452125")*(k**14) )+m("1792/765")*(k**2)*s("5/2")+m("-106496/855")*(k**4)*s("7/2")+m("163053568/137781")*(k**6)*s("9/2")+m("-47529852928/9506889")*(k**8)*s("11/2")+m("334837797879808/30225706875")*(k**10)*s("13/2")+m("-417888017114464256/33560299859625")*(k**12)*s("15/2")+m("2808209287004362375168/501871910867452125")*(k**14)*s("17/2")
    c16 = ( m("16/17")*k+m("-7168/513")*(k**3)+m("32768/1215")*(k**5)+m("-23068672/1760535")*(k**7)+m("2952790016/1395032625")*(k**9)+m("-223338299392/1740163696425")*(k**11)+m("274877906944/93720244793175")*(k**13)+m("-17592186044416/852062453136019125")*(k**15) )+m("-14336/513")*(k**3)*s(3)+m("704512/1215")*(k**5)*s(4)+m("-7243563008/1760535")*(k**7)*s(5)+m("20924946448384/1395032625")*(k**9)*s(6)+m("-52235813160747008/1740163696425")*(k**11)*s(7)+m("2925217769068691456/93720244793175")*(k**13)*s(8)+m("-11232837271162751811584/852062453136019125")*(k**15)*s(9)
    c17 = ( m("1/17")+m("-512/95")*(k**2)+m("16384/567")*(k**4)+m("-23068672/754515")*(k**6)+m("33554432/3444525")*(k**8)+m("-8589934592/7533176175")*(k**10)+m("274877906944/5149463999625")*(k**12)+m("-35184372088832/35765584452623025")*(k**14)+m("562949953421312/97657351483621804875")*(k**16) )+m("-256/95")*(k**2)*s("5/2")+m("106496/567")*(k**4)*s("7/2")+m("-1793589248/754515")*(k**6)*s("9/2")+m("47529852928/3444525")*(k**8)*s("11/2")+m("-334837797879808/7533176175")*(k**10)*s("13/2")+m("417888017114464256/5149463999625")*(k**12)*s("15/2")+m("-2808209287004362375168/35765584452623025")*(k**14)*s("17/2")+m("3055331741978393143410688/97657351483621804875")*(k**16)*s("19/2")
    c18 = ( m("-18/19")*k+m("10240/567")*(k**3)+m("-1261568/27945")*(k**5)+m("92274688/3189375")*(k**7)+m("-9596567552/1506635235")*(k**9)+m("446676598784/801027733275")*(k**11)+m("-137438953472/6678913996755")*(k**13)+m("281474976710656/907034224306084875")*(k**15)+m("-1125899906842624/735934586539255228125")*(k**17) )+m("20480/567")*(k**3)*s(3)+m("-27123712/27945")*(k**5)*s(4)+m("28974252032/3189375")*(k**7)*s(5)+m("-68006075957248/1506635235")*(k**9)*s(6)+m("104471626321494016/801027733275")*(k**11)*s(7)+m("-1462608884534345728/6678913996755")*(k**13)*s(8)+m("179725396338604028985344/907034224306084875")*(k**15)*s(9)+m("-54995971364618275836133376/735934586539255228125")*(k**17)*s(10)
    c19 = ( m("-1/19")+m("128/21")*(k**2)+m("-180224/4347")*(k**4)+m("46137344/820125")*(k**6)+m("-436207616/18600435")*(k**8)+m("4294967296/1155884175")*(k**10)+m("-274877906944/1100919889575")*(k**12)+m("281474976710656/38073041514082575")*(k**14)+m("-562949953421312/6092704638015620625")*(k**16)+m("72057594037927936/186250325161354713133875")*(k**18) )+m("64/21")*(k**2)*s("5/2")+m("-1171456/4347")*(k**4)*s("7/2")+m("3587178496/820125")*(k**6)*s("9/2")+m("-617888088064/18600435")*(k**8)*s("11/2")+m("167418898939904/1155884175")*(k**10)*s("13/2")+m("-417888017114464256/1100919889575")*(k**12)*s("15/2")+m("22465674296034899001344/38073041514082575")*(k**14)*s("17/2")+m("-3055331741978393143410688/6092704638015620625")*(k**16)*s("19/2")+m("33437550590300401257691480064/186250325161354713133875")*(k**18)*s("21/2")
    c20 = ( m("20/21")*k+m("-14080/621")*(k**3)+m("720896/10125")*(k**5)+m("-599785472/10333575")*(k**7)+m("19193135104/1155884175")*(k**9)+m("-111669149696/57084735015")*(k**11)+m("2199023255552/21329435021895")*(k**13)+m("-2392537302040576/962005995476150625")*(k**15)+m("2251799813685248/86443110164928391875")*(k**17)+m("-144115188075855872/1542497866683806408000625")*(k**19) )+m("-28160/621")*(k**3)*s(3)+m("15499264/10125")*(k**5)*s(4)+m("-188332638208/10333575")*(k**7)*s(5)+m("136012151914496/1155884175")*(k**9)*s(6)+m("-26117906580373504/57084735015")*(k**11)*s(7)+m("23401742152549531648/21329435021895")*(k**13)*s(8)+m("-1527665868878134246375424/962005995476150625")*(k**15)*s(9)+m("109991942729236551672266752/86443110164928391875")*(k**17)*s(10)+m("-668751011807305061846512304128/1542497866683806408000625")*(k**19)*s(11)
    res = b*(c1+b*(c2+b*(c3+b*(c4+b*(c5+b*(c6+b*(c7+b*(c8+b*(c9+b*(c10+b*(c11+b*(c12+b*(c13+b*(c14+b*(c15+b*(c16+b*(c17+b*(c18+b*(c19+b*c20)))))))))))))))))))
    # very conservative error bound, based on absolute size of
    # contributions of last three orders
    errorbound = (b**18)*(abs(c18)+b*(abs(c19)+b*abs(c20)))
    return res, errorbound
