from .mpmath import mp, mpf

def taylor_lowx_eq36( theta_degree, x, eps ):
    return _impl_taylor_lowx_eq36( theta_degree, x, eps,
                                   _taylor_lowx_eq36_create_fct,
                                   xmax = 10 )

def taylor_lowx_eq36_scnd_gauss( theta_degree, x, eps ):
    return _impl_taylor_lowx_eq36( theta_degree, x, eps,
                                   _taylor_lowx_eq36_create_fct_scnd_gauss,
                                   xmax = mpf('10') )

def taylor_lowx_eq36_scnd_lorentz( theta_degree, x, eps ):
    return _impl_taylor_lowx_eq36( theta_degree, x, eps,
                                   _taylor_lowx_eq36_create_fct_scnd_lorentz,
                                   xmax = mpf('10') )

def taylor_lowx_eq36_scnd_fresnel( theta_degree, x, eps ):
    return _impl_taylor_lowx_eq36( theta_degree, x, eps,
                                   _taylor_lowx_eq36_create_fct_scnd_fresnel,
                                   xmax = mpf('2') )

def _impl_taylor_lowx_eq36( theta_degree, x, eps,
                            taylor_fact_fct, xmax ):
    #Returns None if x is not low enough!
    sinth = mp.sin(mpf(theta_degree) * mp.pi/mpf(180) )
    x = mpf(x)
    eps = mpf(eps)*0.1 #safety
    taylor_fct = taylor_fact_fct( sinth )
    if x > mpf(xmax):
        #x is clearly too large
        return None
    if mpf(x)==0:
        return mpf(1), mpf(0)
    _, max_err = taylor_fct( x, only_error = True )
    if max_err > eps:
        #x is too large
        return None
    return taylor_fct( x )

def _taylor_lowx_eq36_create_fct( sinth ):
    # Taylor expansion to be used for small x. How small depends on the value of
    # sinth, so the code also returns an error bound. Code validated and
    # produced by the script bin/sagemath_taylor_eq36_lowx:

    m = mpf
    sinth = m(sinth)
    def s( power ):
        return sinth**m(power)
    c0 = m(1)
    c1 = m("-33/35")
    c2 = m("4738/5775")+m("2369/5775")*s("5/2")
    c3 = m("-23431877/39492724")+m("-23431877/19746362")*s(3)
    c4 = m("15818303/43402776")+m("19420368/8197883")*s("7/2")
    c5 = m("-34704149/178624650")+m("-34802273/8331614")*s(4)
    c6 = m("2645475/28932104")+m("22646387/3185480")*s("9/2")
    c7 = m("-7076575/183745624")+m("-39600909/3274684")*s(5)
    c8 = m("3778143/257403272")+m("73661039/3542884")*s("11/2")
    c9 = m("-889661/174179924")+m("-123768155/3419406")*s(6)
    c10 = m("741823/453654554")+m("247568569/3883970")*s("13/2")
    c11 = m("-1288490/2658208971")+m("-271100680/2391297")*s(7)
    c12 = m("215491/1610887604")+m("508831179/2502014")*s("15/2")
    c13 = m("-332827/9637359104")+m("-347802339/946354")*s(8)
    c14 = m("257465/30741493436")+m("66669808/99737")*s("17/2")
    c15 = m("-59163/30895090268")+m("-646003435/528329")*s(9)
    c16 = m("3659/8834425590")+m("4480847453/1993368")*s("19/2")
    c17 = m("-5521/64965502756")+m("-6183925831/1489698")*s(10)
    c18 = m("2581/155607420587")+m("4730431045/614594")*s("21/2")
    c19 = m("-1111/359936825592")+m("-1370036037/95651")*s(11)
    c20 = m("1243/2264668850872")+m("3757982407/140522")*s("23/2")
    c21 = m("-185/1979788177454")+m("-6280699297/125406")*s(12)
    c22 = m("69/4521826134880")+m("3357387539/35697")*s("25/2")
    c23 = m("-4/1670791357815")+m("-14064592969/79428")*s(13)
    c24 = m("17/47034812190742")+m("13816539855/41347")*s("27/2")
    c25 = m("-4/76072947608839")+m("-13446500609/21277")*s(14)
    c26 = m("1/135483517891918")+m("30124753055/25154")*s("29/2")
    c27 = m("-1/999042046860106")+m("-76908109889/33824")*s(15)
    c28 = m("1/7616623882587748")+m("2914716557/674")*s("31/2")
    c29 = m("-1/59972934662820664")+m("-11261686010/1367")*s(16)
    c30 = m("1/487218728395132032")+m("48175741043/3065")*s("33/2")
    def calc_taylor( x ):
        return c0+x*(c1+x*(c2+x*(c3+x*(c4+x*(c5+x*(c6+x*(c7+x*(c8+x*(c9+x*(c10+x*(c11+x*(c12+x*(c13+x*(c14+x*(c15+x*(c16+x*(c17+x*(c18+x*(c19+x*(c20+x*(c21+x*(c22+x*(c23+x*(c24+x*(c25+x*(c26+x*(c27+x*(c28+x*(c29+x*c30)))))))))))))))))))))))))))))
    def calc_taylor_errorbound( x ):
        # very conservative error bound, based on absolute size of
        # contributions of last three orders
        return (x**28)*(abs(c28)+x*(abs(c29)+x*abs(c30)))

    #Wrap up and return:
    def taylor( x, only_error = False ):
        v = None if only_error else calc_taylor(x)
        return v, calc_taylor_errorbound(x)
    return taylor

def _taylor_lowx_eq36_create_fct_scnd_gauss( sinth ):
    # Taylor expansion to be used for small x. How small depends on the value of
    # sinth, so the code also returns an error bound. Code validated and
    # produced by the script "./bin/sagemath_taylor_eq36_lowx_scnd gauss":

    m = mpf
    sinth = m(sinth)
    def s( power ):
        return sinth**m(power)
    c0 = m(1)
    c1 = mp.sqrt(2)*m("-3/8")
    c2 = mp.sqrt(3)*m("2/15")+mp.sqrt(3)*m("1/15")*s(m("5/2"))
    c3 = m("-1/12")+m("-1/6")*s(3)
    c4 = mp.sqrt(5)*m("2/175")+mp.sqrt(5)*m("13/175")*s(m("7/2"))
    c5 = mp.sqrt(3)*mp.sqrt(2)*m("-1/360")+mp.sqrt(3)*mp.sqrt(2)*m("-43/720")*s(4)
    c6 = mp.sqrt(7)*m("4/6615")+mp.sqrt(7)*m("311/6615")*s(m("9/2"))
    c7 = mp.sqrt(2)*m("-1/4200")+mp.sqrt(2)*m("-157/2100")*s(5)
    c8 = m("2/31185")+m("2833/31185")*s(m("11/2"))
    c9 = mp.sqrt(5)*mp.sqrt(2)*m("-1/283500")+mp.sqrt(5)*mp.sqrt(2)*m("-14173/567000")*s(6)
    c10 = mp.sqrt(11)*m("4/7432425")+mp.sqrt(11)*m("155921/7432425")*s(m("13/2"))
    c11 = mp.sqrt(3)*m("-1/6548850")+mp.sqrt(3)*m("-467773/13097700")*s(7)
    c12 = mp.sqrt(13)*m("4/395269875")+mp.sqrt(13)*m("6081071/395269875")*s(m("15/2"))
    c13 = mp.sqrt(7)*mp.sqrt(2)*m("-1/794593800")+mp.sqrt(7)*mp.sqrt(2)*m("-42567521/3178375200")*s(8)
    c14 = mp.sqrt(15)*m("8/54273594375")+mp.sqrt(15)*m("638512867/54273594375")*s(m("17/2"))
    c15 = m("-1/15324309000")+m("-319256437/7662154500")*s(9)
    c16 = mp.sqrt(17)*m("2/1168691398875")+mp.sqrt(17)*m("10854718873/1168691398875")*s(m("19/2"))
    c17 = mp.sqrt(2)*m("-1/1953849397500")+mp.sqrt(2)*m("-97692469873/3907698795000")*s(10)
    c18 = mp.sqrt(19)*m("4/246868871374125")+mp.sqrt(19)*m("1856156927621/246868871374125")*s(m("21/2"))
    c19 = mp.sqrt(5)*m("-1/340295436731250")+mp.sqrt(5)*m("-9280784638123/680590873462500")*s(11)
    c20 = mp.sqrt(21)*m("4/31378332861500625")+mp.sqrt(21)*m("194896477400621/31378332861500625")*s(m("23/2"))
    c21 = mp.sqrt(11)*mp.sqrt(2)*m("-1/94329895061902500")+mp.sqrt(11)*mp.sqrt(2)*m("-2143861251406871/377319580247610000")*s(12)
    c22 = mp.sqrt(23)*m("8/9450855016618640625")+mp.sqrt(23)*m("49308808782358117/9450855016618640625")*s(m("25/2"))
    c23 = mp.sqrt(3)*mp.sqrt(2)*m("-1/7692174170047867500")+mp.sqrt(3)*mp.sqrt(2)*m("-147926426347074373/15384348340095735000")*s(13)
    c24 = m("4/166417229640458671875")+m("3698160658676859371/166417229640458671875")*s(m("27/2"))
    c25 = mp.sqrt(13)*mp.sqrt(2)*m("-1/2916616039476483093750")+mp.sqrt(13)*mp.sqrt(2)*m("-48076088562799171871/11666464157905932375000")*s(14)
    c26 = mp.sqrt(3)*m("8/112930732034015254734375")+mp.sqrt(3)*m("1298054391195577640617/112930732034015254734375")*s(m("29/2"))
    c27 = mp.sqrt(7)*m("-1/318023325842916521953125")+mp.sqrt(7)*m("-9086380738369043484371/1272093303371666087812500")*s(15)
    c28 = mp.sqrt(29)*m("8/78963677410006444227046875")+mp.sqrt(29)*m("263505041412702261046867/78963677410006444227046875")*s(m("31/2"))
    c29 = mp.sqrt(15)*mp.sqrt(2)*m("-1/158103024847621356628125000")+mp.sqrt(15)*mp.sqrt(2)*m("-3952575621190533915703117/1264824198780970853025000000")*s(16)
    c30 = mp.sqrt(31)*m("16/41782676891605134022897734375")+mp.sqrt(31)*m("122529844256906551386796859/41782676891605134022897734375")*s(m("33/2"))
    c31 = mp.sqrt(2)*m("-1/11109372545959527325736250000")+mp.sqrt(2)*m("-61264922128453275693398437/5554686272979763662868125000")*s(17)
    c32 = mp.sqrt(33)*m("2/1556741671283997735369254296875")+mp.sqrt(33)*m("4043484860477916195764296873/1556741671283997735369254296875")*s(m("35/2"))
    c33 = mp.sqrt(17)*mp.sqrt(2)*m("-1/14022805496137413366910581562500")+mp.sqrt(17)*mp.sqrt(2)*m("-68739242628124575327993046873/28045610992274826733821163125000")*s(18)
    c34 = mp.sqrt(35)*m("4/1038535390706582125580428283203125")+mp.sqrt(35)*m("2405873491984360136479756640621/1038535390706582125580428283203125")*s(m("37/2"))
    c35 = m("-1/822808734258651166676076771093750")+m("-21652861427859241228317809765623/1645617468517302333352153542187500")*s(19)
    c36 = mp.sqrt(37)*m("4/385355974831610916140372060398828125")+mp.sqrt(37)*m("801155872830791925447758961328121/385355974831610916140372060398828125")*s(m("39/2"))
    c37 = mp.sqrt(19)*mp.sqrt(2)*m("-1/1928115133946105900577606566929687500")+mp.sqrt(19)*mp.sqrt(2)*m("-15221961583785046583507420265234371/7712460535784423602310426267718750000")*s(20)
    c38 = mp.sqrt(39)*m("8/316418915442139763331368745053426953125")+mp.sqrt(39)*m("593656501767616816756789390344140617/316418915442139763331368745053426953125")*s(m("41/2"))
    c39 = mp.sqrt(5)*mp.sqrt(2)*m("-1/415559551237331771729752573240898437500")+mp.sqrt(5)*mp.sqrt(2)*m("-2968282508838084083783946951720703123/831119102474663543459505146481796875000")*s(21)
    c40 = mp.sqrt(41)*m("4/71518788195447743942718345837075861328125")+mp.sqrt(41)*m("121699582862361447435141825020548828121/71518788195447743942718345837075861328125")*s(m("43/2"))
    c41 = mp.sqrt(21)*mp.sqrt(2)*m("-1/393576450976876921005248662116454910156250")+mp.sqrt(21)*mp.sqrt(2)*m("-2555691240109590396137978325431525390621/1574305803907507684020994648465819640625000")*s(22)
    c42 = mp.sqrt(43)*m("8/70882096544439489636886828855843356708984375")+mp.sqrt(43)*m("109894723324712387033933067993555591796867/70882096544439489636886828855843356708984375")*s(m("45/2"))
    c43 = mp.sqrt(11)*m("-1/101945671670891524371811909408688403990234375")+mp.sqrt(11)*m("-1208841956571836257373263747929111509765621/407782686683566097487247637634753615960937500")*s(23)
    c44 = mp.sqrt(5)*m("8/12783503690747168421722264134350354215771484375")+mp.sqrt(5)*m("54397888045732631581796868656810017939453117/12783503690747168421722264134350354215771484375")*s(m("47/2"))
    c45 = mp.sqrt(23)*mp.sqrt(2)*m("-1/115105931104770248427082174077809997959882812500")+mp.sqrt(23)*mp.sqrt(2)*m("-1251151425051850526381327979106630412607421867/920847448838161987416657392622479983679062500000")*s(24)
    c46 = mp.sqrt(47)*m("16/45141960466345784275347107262160260830346650390625")+mp.sqrt(47)*m("58804116977436974739922415018011629392548828109/45141960466345784275347107262160260830346650390625")*s(m("49/2"))
    c47 = mp.sqrt(3)*m("-1/17641235093231092421976724505403488817764648437500")+mp.sqrt(3)*m("-176412350932310924219767245054034888177646484373/35282470186462184843953449010806977635529296875000")*s(25)
    c48 = m("4/1028660418286304999125462805910077432963856650390625")+m("8644205195683235286768595007647709520704677734371/1028660418286304999125462805910077432963856650390625")*s(m("51/2"))
    c49 = mp.sqrt(2)*m("-1/9364555628656838227332644591618351980763400878906250")+mp.sqrt(2)*m("-216105129892080882169214875191192738017616943359371/37458222514627352909330578366473407923053603515625000")*s(26)
    c50 = mp.sqrt(51)*m("8/9930246823671008616557592729910497504647516164306640625")+mp.sqrt(51)*m("11021361624496124990629958634750829638898464111328117/9930246823671008616557592729910497504647516164306640625")*s(m("53/2"))
    c51 = mp.sqrt(13)*m("-1/16763491030858606110748167083456011880764563913330078125")+mp.sqrt(13)*m("-143277701118449624878189462251760785305680033447265621/67053964123434424442992668333824047523058255653320312500")*s(27)
    c52 = mp.sqrt(53)*m("8/7378562811431624931851960323528594175267012255811767578125")+mp.sqrt(53)*m("7593718159277830118544041499343321621201041772705078117/7378562811431624931851960323528594175267012255811767578125")*s(m("55/2"))
    c53 = mp.sqrt(3)*mp.sqrt(2)*m("-1/8611276392621059354428943060255326718441981370247558593750")+mp.sqrt(3)*mp.sqrt(2)*m("-205030390300501413200689120482269683772428127863037109367/68890211140968474835431544482042613747535850961980468750000")*s(28)
    c54 = mp.sqrt(55)*m("16/11784121682521318723709607199718450074820306648928057861328125")+mp.sqrt(55)*m("11276671466527577726037901626524832607483547032467041015609/11784121682521318723709607199718450074820306648928057861328125")*s(m("57/2"))
    c55 = mp.sqrt(7)*mp.sqrt(2)*m("-1/10682766769290458632466572140861191423489413555423776855468750")+mp.sqrt(7)*mp.sqrt(2)*m("-78936700265693044082265311385673828252384829227269287109371/42731067077161834529866288563444765693957654221695107421875000")*s(29)
    c56 = mp.sqrt(57)*m("8/5043818336876988437724506601610400603842633433134825638427734375")+mp.sqrt(57)*m("4499391915144503512689122748983408210385935265954349365234367/5043818336876988437724506601610400603842633433134825638427734375")*s(m("59/2"))
    c57 = mp.sqrt(29)*mp.sqrt(2)*m("-1/18919943003182637270857761159475231524672857793338039080810546875")+mp.sqrt(29)*mp.sqrt(2)*m("-130482365539190601867984559720518838101192122712676131591796867/151359544025461098166862089275801852197382862346704312646484375000")*s(30)
    c58 = mp.sqrt(59)*m("16/9235585326985757197083236465204896867081745509644120819444580078125")+mp.sqrt(59)*m("7698459566812245510211089023510611447970335240047891763916015609/9235585326985757197083236465204896867081745509644120819444580078125")*s(m("61/2"))
    c59 = mp.sqrt(15)*m("-2/17898918492838470811240781979662171616531029433111348351104736328125")+mp.sqrt(15)*m("-115476893502183682653166335352659171719555028600718376458740234367/71595673971353883244963127918648686466124117732445393404418945312500")*s(31)
    c60 = mp.sqrt(61)*m("16/9023479935154135146201070610792140337337749489888734654862420654296875")+mp.sqrt(61)*m("7044090503633204641843146456512209474892856744643820963983154296859/9023479935154135146201070610792140337337749489888734654862420654296875")*s(m("63/2"))
    def calc_taylor( x ):
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return c0+u*(c1+u*(c2+u*(c3+u*(c4+u*(c5+u*(c6+u*(c7+u*(c8+u*(c9+u*(c10+u*(c11+u*(c12+u*(c13+u*(c14+u*(c15+u*(c16+u*(c17+u*(c18+u*(c19+u*(c20+u*(c21+u*(c22+u*(c23+u*(c24+u*(c25+u*(c26+u*(c27+u*(c28+u*(c29+u*(c30+u*(c31+u*(c32+u*(c33+u*(c34+u*(c35+u*(c36+u*(c37+u*(c38+u*(c39+u*(c40+u*(c41+u*(c42+u*(c43+u*(c44+u*(c45+u*(c46+u*(c47+u*(c48+u*(c49+u*(c50+u*(c51+u*(c52+u*(c53+u*(c54+u*(c55+u*(c56+u*(c57+u*(c58+u*(c59+u*c60)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
    def calc_taylor_errorbound( x ):
        # very conservative error bound, based on absolute size of
        # contributions of last three orders
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return (u**58)*(abs(c58)+u*(abs(c59)+u*abs(c60)))

    #Wrap up and return:
    def taylor( x, only_error = False ):
        v = None if only_error else calc_taylor(x)
        return v, calc_taylor_errorbound(x)
    return taylor

def _taylor_lowx_eq36_create_fct_scnd_lorentz( sinth ):
    # Taylor expansion to be used for small x. How small depends on the value of
    # sinth, so the code also returns an error bound. Code validated and
    # produced by the script "./bin/sagemath_taylor_eq36_lowx_scnd lorentz":

    m = mpf
    sinth = m(sinth)
    def s( power ):
        return sinth**m(power)
    c0 = m(1)
    c1 = m("-1/2")
    c2 = m("4/15")+m("2/15")*s(m("5/2"))
    c3 = m("-10/81")+m("-20/81")*s(3)
    c4 = m("4/81")+m("26/81")*s(m("7/2"))
    c5 = m("-7/405")+m("-301/810")*s(4)
    c6 = m("176/32805")+m("13684/32805")*s(m("9/2"))
    c7 = m("-572/382725")+m("-179608/382725")*s(5)
    c8 = m("52/137781")+m("73658/137781")*s(m("11/2"))
    c9 = m("-4862/55801305")+m("-34454563/55801305")*s(6)
    c10 = m("5168/279006525")+m("201449932/279006525")*s(m("13/2"))
    c11 = m("-33592/9207215325")+m("-7856715308/9207215325")*s(7)
    c12 = m("118864/177567724125")+m("180705105836/177567724125")*s(m("15/2"))
    c13 = m("-14858/129269303163")+m("-316234113509/258538606326")*s(8)
    c14 = m("27968/1508141870235")+m("2232240983032/1508141870235")*s(m("17/2"))
    c15 = m("-1723528/610797457445175")+m("-1100494816699472/610797457445175")*s(9)
    c16 = m("82708/203599152481725")+m("448886044274042/203599152481725")*s(m("19/2"))
    c17 = m("-785726/14159395604410875")+m("-38379756791716399/14159395604410875")*s(10)
    c18 = m("330832/45876441758291235")+m("153519027169677668/45876441758291235")*s(m("21/2"))
    c19 = m("-6120392/6848697376773477225")+m("-28401020026445452108/6848697376773477225")*s(11)
    c20 = m("532208/5028763808120385375")+m("25931366111107425292/5028763808120385375")*s(m("23/2"))
    c21 = m("-125468036/10454799957082281194625")+m("-67246515167630585318839/10454799957082281194625")*s(12)
    c22 = m("3753130816/2875069988197627328521875")+m("23132801217664960757554184/2875069988197627328521875")*s(m("25/2"))
    c23 = m("-938282704/6877167411768724569824325")+m("-69398403652994892593772296/6877167411768724569824325")*s(13)
    c24 = m("44099287088/3213753232807307827821751875")+m("40771562146134499905983025412/3213753232807307827821751875")*s(m("27/2"))
    c25 = m("-22049643544/16578885724799603873683640625")+m("-265015153949874249653485387706/16578885724799603873683640625")*s(14)
    c26 = m("6082660288/48900746969787066887924015625")+m("986952987123669619475220214712/48900746969787066887924015625")*s(m("29/2"))
    c27 = m("-4674524431328/415900852978039003881793752890625")+m("-10618627188463561435994663107693672/415900852978039003881793752890625")*s(15)
    c28 = m("10399386944/10586567166713720098809295528125")+m("342536360918179401161258556488056/10586567166713720098809295528125")*s(m("31/2"))
    c29 = m("-20148812204/242376669343182539104318081828125")+m("-19909925978369177692498717762609967/484753338686365078208636163656250")*s(16)
    c30 = m("2454255318784/359929353974626070569912351514765625")+m("18794970123580503741718825154605931216/359929353974626070569912351514765625")*s(m("33/2"))
    c31 = m("-9356848402864/17243888140420721744576709931661953125")+m("-1146493177538410728244848474783687847136/17243888140420721744576709931661953125")*s(17)
    c32 = m("2339212100716/55789049866067040938336414484788671875")+m("4729284357345944254009999994740499930534/55789049866067040938336414484788671875")*s(m("35/2"))
    c33 = m("-1169606050358/371444720141238447952958975912568796875")+m("-40198917037440526159084999974007946215267/371444720141238447952958975912568796875")*s(18)
    c34 = m("16943482243024/73669869494678958844003530222659478046875")+m("10190968697599787442492359453149690038069476/73669869494678958844003530222659478046875")*s(m("37/2"))
    c35 = m("-313454421495944/19170181257637111681798309929678998961328125")+m("-3393592576300729218349955697904175507842566556/19170181257637111681798309929678998961328125")*s(19)
    c36 = m("1202987239254704/1062431624436414663207032650313262416119921875")+m("240945072917351774502846854551217513333509182796/1062431624436414663207032650313262416119921875")*s(m("39/2"))
    c37 = m("-21954517116398348/287265166145692118551747674296239799435501953125")+m("-83547704034091727808862146815635067929702404304777/287265166145692118551747674296239799435501953125")*s(20)
    c38 = m("8567616435667648/1702907904911662878774760213228109531053655578125")+m("635777650210649245764999751377515797380590648707352/1702907904911662878774760213228109531053655578125")*s(m("41/2"))
    c39 = m("-87818068465593392/271691215738178941113609470383212020636287776328125")+m("-130334418293183095381824949032390740131564383831281608/271691215738178941113609470383212020636287776328125")*s(21)
    c40 = m("3935126153591536/194065154098699243652578193130865729025919840234375")+m("119725802850714703897257802018126377639451080026095964/194065154098699243652578193130865729025919840234375")*s(m("43/2"))
    c41 = m("-84605212302218024/68073743498843723579021039523793678503869881735546875")+m("-54056199987097688809611897611184059505904266877826688226/68073743498843723579021039523793678503869881735546875")*s(22)
    c42 = m("1306461882992389952/17544460256292905122411331549995916232588283156388671875")+m("17946658395716432684791150006913107755986999072039804485048/17544460256292905122411331549995916232588283156388671875")*s(m("45/2"))
    c43 = m("-653230941496194976/149698967159380795942519902692082802113198378398707734375")+m("-197413242352880759532702650076044185315870707642209269430024/149698967159380795942519902692082802113198378398707734375")*s(23)
    c44 = m("27797061340263616/111095935148266107933354350573584688224937327297391796875")+m("189012678848502854871736579860042305089664041124040456611384/111095935148266107933354350573584688224937327297391796875")*s(m("47/2"))
    c45 = m("-14534388448290338216/1034858635906098795399195775592941370815291203775204587890625")+m("-2273090102416951395544363076469351266296436286319396898653021159/1034858635906098795399195775592941370815291203775204587890625")*s(24)
    c46 = m("9895753837133847296/12816326183144762004559270759266427746250914139062149126953125")+m("36369441638671222328709809223509620260742980803764811713959902704/12816326183144762004559270759266427746250914139062149126953125")*s(m("49/2"))
    c47 = m("-1236969229641730912/29741639101767798595175397910740064388106960065960550146484375")+m("-109108324916013666986129427670528860782228942439744727423639519088/29741639101767798595175397910740064388106960065960550146484375")*s(25)
    c48 = m("618484614820865456/281650191594888235033300999751770437117016268986744729829296875")+m("1336576980221167420580085488963978544582304544901407299387874447044/281650191594888235033300999751770437117016268986744729829296875")*s(m("51/2"))
    c49 = m("-29996503818811974616/263839958891093831935606965943937894769910828447877048384208984375")+m("-1620599588518165497453353655368823985306044260693676266599449254431634/263839958891093831935606965943937894769910828447877048384208984375")*s(26)
    c50 = m("4527774161330109376/784139737963041108899531192490724512428056657974459759183837890625")+m("6237779548258599273216681994249813075517604324179544107566719529265624/784139737963041108899531192490724512428056657974459759183837890625")*s(m("53/2"))
    c51 = m("-12118587542800037744864/42110656347829196671231523630329378490923926703202412447449646240234375")+m("-434080840983767664823875683297850242112194567315330597866149015323009130136/42110656347829196671231523630329378490923926703202412447449646240234375")*s(27)
    c52 = m("47102434600317127838528/3345457698744208402214504377298389513445623065865524988880721895751953125")+m("44710326621328069476859195379678574937556040433479052781325430886356700286472/3345457698744208402214504377298389513445623065865524988880721895751953125")*s(m("55/2"))
    c53 = m("-11775608650079281959632/17408545334192589903887111868778165068147951299103877305775683755712890625")+m("-301794704693964468968799568812830380828503272925983606580112483384969057884118/17408545334192589903887111868778165068147951299103877305775683755712890625")*s(28)
    c54 = m("20159842008935730714889984/631519851348313616749081964628311906654307144733991869091735464929564697265625")+m("14208494696991847199051083699708054329405934089355308198325931531001140109128860016/631519851348313616749081964628311906654307144733991869091735464929564697265625")*s(m("57/2"))
    c55 = m("-549355694743498661980752064/371101007384416922684394743951321180936596803734474695705748761365188939208984375")+m("-10841081453804779412875976862877245453336727710178100155337518361911944367138800497936/371101007384416922684394743951321180936596803734474695705748761365188939208984375")*s(29)
    c56 = m("9311113470228790881029696/137995621571651772740981829297835182845947926085792547610991384701500826416015625")+m("5236793583617562936728226111728838905425368470170777193680243738916878994519665845304/137995621571651772740981829297835182845947926085792547610991384701500826416015625")*s(m("59/2"))
    c57 = m("-31038596753007674401912491616/10264804310607317115337933372319470075995836481891678654043594151021138972955322265625")+m("-506248690918685235437922710559994450245828508064114287478860551687412151933591130314070884/10264804310607317115337933372319470075995836481891678654043594151021138972955322265625")*s(30)
    c58 = m("68993824402351040626646272/517703173926282080599652291821329795137181318217145532116981270225413965592529296875")+m("33196635470077720356585095774425865589890393971417330326482661093367415265928666404603728/517703173926282080599652291821329795137181318217145532116981270225413965592529296875")*s(m("61/2"))
    c59 = m("-2104311644271706739112711296/364184271196603817467986169900466228963809473468907376246907208939339285795667724609375")+m("-30374921455121114126275362633599667014749710483846857248731634961456222652204225194481038704/364184271196603817467986169900466228963809473468907376246907208939339285795667724609375")*s(31)
    c60 = m("68993824402351040626646272/279875957940464034297029219752730213909568950199065440948761707059644043163653564453125")+m("30374921455121114126275362633599667014749710483846857248731634963491540472073580892967103728/279875957940464034297029219752730213909568950199065440948761707059644043163653564453125")*s(m("63/2"))
    def calc_taylor( x ):
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return c0+u*(c1+u*(c2+u*(c3+u*(c4+u*(c5+u*(c6+u*(c7+u*(c8+u*(c9+u*(c10+u*(c11+u*(c12+u*(c13+u*(c14+u*(c15+u*(c16+u*(c17+u*(c18+u*(c19+u*(c20+u*(c21+u*(c22+u*(c23+u*(c24+u*(c25+u*(c26+u*(c27+u*(c28+u*(c29+u*(c30+u*(c31+u*(c32+u*(c33+u*(c34+u*(c35+u*(c36+u*(c37+u*(c38+u*(c39+u*(c40+u*(c41+u*(c42+u*(c43+u*(c44+u*(c45+u*(c46+u*(c47+u*(c48+u*(c49+u*(c50+u*(c51+u*(c52+u*(c53+u*(c54+u*(c55+u*(c56+u*(c57+u*(c58+u*(c59+u*c60)))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
    def calc_taylor_errorbound( x ):
        # very conservative error bound, based on absolute size of
        # contributions of last three orders
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return (u**58)*(abs(c58)+u*(abs(c59)+u*abs(c60)))

    #Wrap up and return:
    def taylor( x, only_error = False ):
        v = None if only_error else calc_taylor(x)
        return v, calc_taylor_errorbound(x)
    return taylor


def _taylor_lowx_eq36_create_fct_scnd_fresnel( sinth ):
    # Taylor expansion to be used for small x. How small depends on the value of
    # sinth, so the code also returns an error bound. Code validated and
    # produced by the script "./bin/sagemath_taylor_eq36_lowx_scnd fresnel":


    m = mpf
    sinth = m(sinth)
    def s( power ):
        return sinth**m(power)
    c0 = m(1)
    c1 = m("-1/2")
    c2 = m("11/50")+m("11/100")*s(m("5/2"))
    c3 = m("-151/1890")+m("-151/945")*s(3)
    c4 = m("15619/635040")+m("203047/1270080")*s(m("7/2"))
    c5 = m("-655177/99792000")+m("-28172611/199584000")*s(4)
    c6 = m("27085381/17513496000")+m("8423553491/70053984000")*s(m("9/2"))
    c7 = m("-2330931341/7151344200000")+m("-365956220537/3575672100000")*s(5)
    c8 = m("12157712239/195628085452800")+m("34442798773087/391256170905600")*s(m("11/2"))
    c9 = m("-37307713155613/3448638596590387200")+m("-528762218554503049/6897277193180774400")*s(6)
    c10 = m("339781108897078469/196141320181078272000000")+m("52979010280341371964949/784565280724313088000000")*s(m("13/2"))
    c11 = m("-75489558096433522049/293925312188275832064000000")+m("-35311977059442997909426877/587850624376551664128000000")*s(7)
    c12 = m("11482547005345338463969/323917690982997855744000000000")+m("69826183600342382718426430799/1295670763931991422976000000000")*s(m("15/2"))
    c13 = m("-3607856726470666022715979/788286092776223581738598400000000")+m("-153577516969031331805948913118059/3153144371104894326954393600000000")*s(8)
    c14 = m("18497593486903125823791655511/33324597500591657862103812710400000000")+m("513519628257523557435258555261085219/11591164348031880995514369638400000000")*s(m("17/2"))
    c15 = m("-520679973964725199436393399689/8203731796469181656053203305472000000000")+m("-166230433305230930856177364915027048093/4101865898234590828026601652736000000000")*s(9)
    c16 = m("53566213980441557762900314820839/7803243840680659472452810482772869120000000")+m("581446193848655429922473706503402706994447/15606487681361318944905620965545738240000000")*s(m("19/2"))
    c17 = m("-731509401860533204925821188658871713/1038550150637958823208686553069046988800000000000")+m("-71462960203076390269931921672841874096424402449/2077100301275917646417373106138093977600000000000")*s(10)
    c18 = m("15405709916669781801989122003838993353/224102505705261306707263219167451235431219200000000")+m("28595415186746154121592585685109112869261921103213/896410022821045226829052876669804941724876800000000")*s(m("21/2"))
    c19 = m("-10572354363336924802260977429426060187229/1652691950288957776592721309011619303809404108800000000")+m("-3383439447036206955506045129122765819528196979004523/113978755192341915627084228207697883021338214400000000")*s(11)
    c20 = m("73263397350713233504412348770826572846164431/128800703233263403580738528462641074668782485504000000000000")+m("14278778066055998157328417050500559002618623004812827511651/515202812933053614322954113850564298675129942016000000000000")*s(m("23/2"))
    def calc_taylor( x ):
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return c0+u*(c1+u*(c2+u*(c3+u*(c4+u*(c5+u*(c6+u*(c7+u*(c8+u*(c9+u*(c10+u*(c11+u*(c12+u*(c13+u*(c14+u*(c15+u*(c16+u*(c17+u*(c18+u*(c19+u*c20)))))))))))))))))))
    def calc_taylor_errorbound( x ):
        # very conservative error bound, based on absolute size of
        # contributions of last three orders
        u = m(x)*m(2) # Keep coefficients small by this variable change
        return (u**18)*(abs(c18)+u*(abs(c19)+u*abs(c20)))

    #Wrap up and return:
    def taylor( x, only_error = False ):
        v = None if only_error else calc_taylor(x)
        return v, calc_taylor_errorbound(x)
    return taylor
